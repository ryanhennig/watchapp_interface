# Watchapp API Interface

## Meta

The 'json5' directory is the primary source of truth in this repository.  Changes are made there, 
because the json5 format allows for comments.  So refer to those files to understand the data format.

The 'json' directory contains versions of these files in legacy JSON format, 
which is how the data will actually be returned by the API.  Use those for testing.

It is generated by running the command:

`python refresh_json_files.py `

Note that you may need to first install dependencies using this command:

`pip install -r requirements.txt`


## API Specification

### Get Filter Options

GET /api/v1/filters

#### Input
- brand_and_refnum: Watch Brand and Reference Number, separated by one space.

##### Examples:
- "Rolex 1601"
- "Certina C034.453.16.057.00"
- "Franck Muller 952 QZ REL MOP COL DRM D"
- "Union Glash√ºtte D001.407.11.051.00"
- "Maurice Lacroix AI6008-BRZ01-420-1"

###### Things to Note:
- Reference numbers can contain spaces and other special characters
- Brands can contain spaces and non-ASCII characters
- The response will contain separate fields for brand and reference number,
so you don't need to try and parse them out.


#### Output

See files with "watch_filters" prefix in the json/json5 directories.

Note that the filter_choices key maps to a dictionary with 9 filter names:
- bezel_type
- box_and_papers
- bracelet
- case_material
- condition
- dial_color
- dial_markers
- modified
- size

Each filter name maps to an array of (option_name, option_display_value) tuples.  The intention is for the 
frontend to create a form with drop-down options, and then GET the market_report URL with a set of filter_name=option_name parameters 


### Market Report

GET /api/v1/market_report

#### Input
- brand_and_refnum: Watch Brand and Reference Number, separated by one space.
- Up to nine filter values, in the format filter_name=option_name. These must exactly match the values returned by the "Get Watch Filters" API

##### Input Example:
- brand_and_refnum="Rolex 1601"
- bezel_type="blue"
- dial_markers="dot_and_numbers"

#### Output
See files with "market_report" prefix in the json/json5 directories.


### Sales Ticker

GET /api/v1/sales_ticker

#### Input
- None

##### Input Example:
- brand_and_refnum="Rolex 1601"
- bezel_type="blue"
- dial_markers="dot_and_numbers"

#### Output
See files with "market_report" prefix in the json/json5 directories.


### Error Responses

On error, the caller will receive a JSON response like the following:

`{"error": "No product was found matching the query 'Rolex 1234'."}`